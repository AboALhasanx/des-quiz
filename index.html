<!doctype html><html lang="ar" dir="rtl"><meta charset="utf-8">
<title>منصة الاختبارات</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* ---------- مظهر عام ---------- */
*{box-sizing:border-box}
body{margin:0;font-family:"Cairo",sans-serif;background:#f8f9fa;color:#212529}
.container{max-width:650px;padding:24px;margin:auto}
h2,h3{text-align:center}
.btn{display:block;width:100%;padding:.8rem;border:none;border-radius:6px;font-size:1rem;color:#fff;cursor:pointer}
.btn-main{background:#27ae60}
.btn-sec {background:#6c757d}
.btn:disabled{opacity:.5;cursor:not-allowed}
.card{background:#fff;border:1px solid #ced4da;border-radius:8px;margin-top:1rem;padding:1rem 1.25rem}
.option{display:flex;align-items:center;border:1px solid #ddd;border-radius:6px;padding:.35rem .75rem;margin:.4rem 0;cursor:pointer;transition:.15s}
.option input{margin-left:.5rem;cursor:pointer}
.option.selected{border:2px solid #000}
.option.correct{border:2px solid #198754;background:#d1e7dd}
.option.wrong  {border:2px solid #dc3545;background:#f8d7da}
.center-vh{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}
</style>

<body>
<div id="app" class="container"></div>

<script>
/* ---------- بيانات المواد وروابط JSON ---------- */
const COURSES = {
  des   : {title:"اختبار تصميم وتحليل الأنظمة",
           src :"https://raw.githubusercontent.com/AboALhasanx/json-files/refs/heads/main/dess_quiz.json"},
  mobile: {title:"اختبار تطبيقات الموبايل",
           src :"https://raw.githubusercontent.com/AboALhasanx/json-files/refs/heads/main/mobApp_quiz.json"},
  iot   : {title:"اختبار إنترنت الأشياء",
           src :"https://raw.githubusercontent.com/AboALhasanx/json-files/refs/heads/main/iot_quiz.json"}
};

const tg = window.Telegram?.WebApp; if(tg) tg.expand();
const app = document.getElementById("app");

/* ---------- واجهة اختيار المادة ---------- */
function renderHome(){
  app.innerHTML = `<h2 class="mb-4 fw-bold">اختر الاختبار</h2>` +
    Object.entries(COURSES).map(([key,val])=>
      `<button class="btn btn-main mb-3" onclick="startQuiz('${key}')">${val.title}</button>`
    ).join("");
}

/* ---------- بدء اختبار لمادة مختارة ---------- */
let quizData=[], answers=[], reviewed=false;

function startQuiz(courseKey){
  const {title, src} = COURSES[courseKey];
  app.innerHTML=`<h3 id="title" class="fw-bold mb-3">${title}</h3><div id="quiz"></div>
                 <button id="submit" class="btn btn-main mt-4" disabled>إظهار النتيجة</button>`;
  fetch(src).then(r=>r.json()).then(data=>{
      quizData=data;
      renderQuestions();
  });
}

function renderQuestions(){
  const box=document.getElementById("quiz");
  quizData.forEach((q,i)=>{
     const card=document.createElement("div");
     card.className="card";
     card.innerHTML=`
       <h5 class="mb-2">${i+1}. ${q.question}</h5>
       ${q.options.map((opt,idx)=>`
         <label class="option" id="lbl-${i}-${idx}">
            <input type="radio" name="q${i}" value="${idx}">
            ${opt}
         </label>`).join("")}`;
     box.appendChild(card);
  });
}

/* ---------- متابعة التحديد ---------- */
document.addEventListener("change",e=>{
  if(e.target.type!=="radio") return;
  const name=e.target.name;                                   // q0
  document.querySelectorAll(`input[name="${name}"]`).forEach(inp=>{
      document.getElementById(`lbl-${name.slice(1)}-${inp.value}`)
              .classList.toggle("selected",inp.checked);
  });
  answers=quizData.map((_,i)=>{
     const sel=document.querySelector(`input[name=q${i}]:checked`);
     return sel ? Number(sel.value): null;
  });
  document.getElementById("submit").disabled = answers.includes(null);
});

/* ---------- زر إظهار النتيجة ثم المراجعة ---------- */
document.addEventListener("click",e=>{
  if(e.target.id!=="submit") return;
  if(!reviewed){
     showScore();
     e.target.textContent="🔍 عرض التصحيح";
     reviewed=true;
     return;
  }
  showReview();
  e.target.remove();
});

function showScore(){
  const score=answers.reduce((acc,ans,i)=> ans===quizData[i].correct_option_id?acc+1:acc,0);
  const summary=document.createElement("div");
  summary.className="alert alert-info text-center mb-3";
  summary.innerHTML=`درجتك: <strong>${score}</strong> من <strong>${quizData.length}</strong>`;
  app.prepend(summary);
  window.scrollTo({top:0,behavior:"smooth"});
}

function showReview(){
  quizData.forEach((q,i)=>{
    const correct=q.correct_option_id;
    document.getElementById(`lbl-${i}-${correct}`).classList.add("correct");
    const user=answers[i];
    if(user!==correct && user!==null){
      document.getElementById(`lbl-${i}-${user}`).classList.add("wrong");
    }
  });
  window.scrollTo({top:0,behavior:"smooth"});
  // زر عودة وإغلاق
  app.insertAdjacentHTML("beforeend",
    `<div class="text-center mt-4">
        <button class="btn btn-main mb-2" onclick="renderHome()">العودة للاختبارات</button>
        <button class="btn btn-sec" onclick="Telegram.WebApp.close()">إغلاق النافذة</button>
     </div>`);
}

/* ---------- تشغيل الصفحة --------- */
renderHome();
</script>
</body></html>
