<!doctype html><html lang="ar" dir="rtl"><meta charset="utf-8">
<title>منصة الاختبارات</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* —— أساسيات —— */
*{box-sizing:border-box;margin:0}
body{font-family:"Cairo",sans-serif;background:#eef2f5;color:#222}

/* شريط علوي */
.topbar{background:#1e88e5;color:#fff;padding:.9rem 1.2rem;display:flex;align-items:center;gap:10px}
.topbar h1{font-size:1.2rem;margin:0 auto 0 0}
.back{font-size:1.5rem;cursor:pointer;opacity:.9}
.back:hover{opacity:1}

/* محتوى مركزي */
.container{max-width:700px;margin:auto;padding:24px}

/* زر عام */
.btn{display:block;width:90%;max-width:520px;margin:12px auto;padding:.9rem;border:none;border-radius:12px;font-size:1.05rem;cursor:pointer;transition:.15s;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.btn-main{background:#2ecc71;color:#fff}
.btn-main:hover{filter:brightness(1.07)}
.btn-sec{background:#6c757d;color:#fff}
.btn-sec:hover{filter:brightness(1.12)}
.btn:disabled{opacity:.55;cursor:not-allowed;box-shadow:none}

/* بطاقات الأسئلة */
.card{background:#fff;border-radius:12px;margin-top:20px;padding:1.3rem 1.4rem;box-shadow:0 2px 6px rgba(0,0,0,.08)}
.card h4{margin-bottom:.8rem;font-size:1.05rem}

/* خيار */
.option{display:flex;align-items:center;border:2px solid #ced4da;border-radius:10px;padding:.55rem .85rem;margin:.5rem 0;cursor:pointer;transition:.15s;font-size:.97rem}
.option input{margin-left:.6rem;cursor:pointer}
.option.selected{border-color:#000}
.option.correct {border-color:#198754;background:#d1e7dd}
.option.wrong   {border-color:#dc3545;background:#f8d7da}

/* صندوق نتيجة */
.result-box{max-width:520px;margin:0 auto 1.5rem;padding:1.2rem;border-radius:12px;text-align:center;font-size:1.1rem;font-weight:700;box-shadow:0 2px 6px rgba(0,0,0,.08)}
.pass{background:#d1e7dd;color:#0f5132}
.fail{background:#f8d7da;color:#842029}
</style>

<body>
<div class="topbar">
  <span id="backBtn" class="back" style="display:none" onclick="renderHome()">⟵</span>
  <h1 id="barTitle">منصة الاختبارات</h1>
</div>

<div id="app" class="container"></div>

<script>
/* روابط JSON */
const COURSES={
  des   :{title:"اختبار تصميم وتحليل الأنظمة",
          src:"https://raw.githubusercontent.com/AboALhasanx/json-files/refs/heads/main/dess_quiz.json"},
  mobile:{title:"اختبار تطبيقات الموبايل",
          src:"https://raw.githubusercontent.com/AboALhasanx/json-files/refs/heads/main/mobApp_quiz.json"},
  iot   :{title:"اختبار إنترنت الأشياء",
          src:"https://raw.githubusercontent.com/AboALhasanx/json-files/refs/heads/main/iot_quiz.json"}
};

const tg = window.Telegram?.WebApp; if(tg) tg.expand();
const app     = document.getElementById("app");
const barTitle= document.getElementById("barTitle");
const backBtn = document.getElementById("backBtn");

let quizData=[],answers=[],reviewed=false;

/* شاشة البداية */
function renderHome(){
  backBtn.style.display="none";
  barTitle.textContent="منصة الاختبارات";
  app.innerHTML=`<h2 class="fw-bold mb-4" style="text-align:center">اختر الاختبار</h2>`+
    Object.entries(COURSES).map(([k,v])=>
      `<button class="btn btn-main" onclick="startQuiz('${k}')">${v.title}</button>`
    ).join("");
}

function startQuiz(key){
  const {title,src}=COURSES[key];
  backBtn.style.display="block";
  barTitle.textContent=title;
  reviewed=false;
  app.innerHTML=`<div id="quiz"></div>
                 <button id="submit" class="btn btn-main mt-3" disabled>إظهار النتيجة</button>`;
  fetch(src).then(r=>r.json()).then(data=>{quizData=data;renderQuestions();});
}

function renderQuestions(){
  const box=document.getElementById("quiz");
  box.innerHTML="";
  quizData.forEach((q,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<h4>${i+1}. ${q.question}</h4>`+
      q.options.map((opt,idx)=>`
        <label class="option" id="lbl-${i}-${idx}">
          <input type="radio" name="q${i}" value="${idx}"> ${opt}
        </label>`).join("");
    box.appendChild(card);
  });
}

/* متابعة التحديد */
document.addEventListener("change",e=>{
  if(e.target.type!=="radio")return;
  const name=e.target.name;                 // مثل q0
  document.querySelectorAll(`input[name="${name}"]`).forEach(inp=>{
      document.getElementById(`lbl-${name.slice(1)}-${inp.value}`)
              .classList.toggle("selected",inp.checked);
  });
  answers=quizData.map((_,i)=>{
     const sel=document.querySelector(`input[name=q${i}]:checked`);
     return sel?Number(sel.value):null;
  });
  document.getElementById("submit").disabled = answers.includes(null);
});

/* زر النتيجة/التصحيح */
document.addEventListener("click",e=>{
  if(e.target.id!=="submit")return;
  if(!reviewed){
      showScore();
      e.target.textContent="🔍 عرض التصحيح";
      reviewed=true;
      return;
  }
  showReview();
  e.target.remove();
});

function showScore(){
  const score=answers.reduce((s,a,i)=> a===quizData[i].correct_option_id? s+1 : s ,0);
  const pass = score >= Math.ceil(quizData.length/2);
  const box  = document.createElement("div");
  box.className=`result-box ${pass?'pass':'fail'}`;
  box.innerHTML = pass
     ? `مبروك! درجتك <span>${score}</span> من <span>${quizData.length}</span>`
     : `حظًا أوفر! درجتك <span>${score}</span> من <span>${quizData.length}</span>`;
  app.prepend(box);
  addFooterButtons();
  window.scrollTo({top:0,behavior:"smooth"});
}

function showReview(){
  quizData.forEach((q,i)=>{
     const cor=q.correct_option_id;
     document.getElementById(`lbl-${i}-${cor}`).classList.add("correct");
     const user=answers[i];
     if(user!==cor && user!==null){
       document.getElementById(`lbl-${i}-${user}`).classList.add("wrong");
     }
  });
  addFooterButtons();            // للتأكّد أنها موجودة
  window.scrollTo({top:0,behavior:"smooth"});
}

/* أزرار رجوع/إغلاق – تُضاف مرة واحدة */
function addFooterButtons(){
  if(document.getElementById("footerBtns")) return;
  app.insertAdjacentHTML("beforeend",`
    <div id="footerBtns" class="text-center mt-4">
       <button class="btn btn-main mb-2" onclick="renderHome()">العودة للاختبارات</button>
       <button class="btn btn-sec"  onclick="tg?tg.close():window.close()">إغلاق النافذة</button>
    </div>`);
}

/* تشغيل */
renderHome();
</script>
</body></html>
